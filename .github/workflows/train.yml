name: Train + Backtest

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install pandas numpy scikit-learn joblib

      # ğŸ”¥ 1. ëª¨ë¸ í•™ìŠµ + scored_dataset ìƒì„±
      - name: Train Model
        run: |
          PYTHONPATH=. python app/train_model.py

      # ğŸ”¥ 2. ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      - name: Run Backtest
        run: |
          PYTHONPATH=. python app/backtest_real_market.py

      # ğŸ”¥ 3. ëª¨ë“  ê²°ê³¼ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•˜ê²Œ
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: etf_engine_outputs
          path: |
            model.pkl
            scaler.pkl
            data/scored_dataset.csv
            data/backtest_results.csv
